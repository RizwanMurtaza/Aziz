@model Nop.Plugin.Misc.RepairAppointment.Models.SlotCapacity.SlotCapacityModel
@{
    Layout = "_AdminLayout";
    ViewBag.Title = "Add New Slot";
    NopHtml.SetActiveMenuItemSystemName("RepairAppointments.SlotManagement");
}

<div class="content-header clearfix">
    <h1 class="float-left">
        Add New Slot
    </h1>
    <div class="float-right">
        <a asp-action="List" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i>
            Back to List
        </a>
    </div>
</div>

<form asp-action="Create" method="post">
    <section class="content">
        <div class="container-fluid">
            <div class="form-horizontal">
                <div class="card card-default">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-clock"></i>
                            Slot Details
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group row">
                            <div class="col-md-3">
                                <nop-label asp-for="Date" />
                            </div>
                            <div class="col-md-9">
                                <nop-editor asp-for="Date" />
                                <span asp-validation-for="Date"></span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <label>Time Slot</label>
                            </div>
                            <div class="col-md-9">
                                <select id="time-slot-selector" class="form-control">
                                    <option value="">Select a time slot...</option>
                                </select>
                                <span class="help-block">Select from available time slots based on business hours</span>
                                <input type="hidden" asp-for="StartTime" id="hidden-start-time" />
                                <input type="hidden" asp-for="EndTime" id="hidden-end-time" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <nop-label asp-for="MaxAppointments" />
                            </div>
                            <div class="col-md-9">
                                <nop-editor asp-for="MaxAppointments" />
                                <span asp-validation-for="MaxAppointments"></span>
                                <span class="help-block">Maximum number of appointments allowed for this slot</span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <nop-label asp-for="IsActive" />
                            </div>
                            <div class="col-md-9">
                                <nop-editor asp-for="IsActive" />
                                <span asp-validation-for="IsActive"></span>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-md-3">
                                <nop-label asp-for="Notes" />
                            </div>
                            <div class="col-md-9">
                                <nop-editor asp-for="Notes" />
                                <span asp-validation-for="Notes"></span>
                                <span class="help-block">Optional notes about this slot (e.g., special conditions, extra staff)</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-3 col-md-9">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i>
                            Save
                        </button>
                        <a asp-action="List" class="btn btn-outline-secondary">
                            Cancel
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</form>

<script>
$(document).ready(function() {
    // Load available time slots when page loads
    loadTimeSlots();

    function loadTimeSlots() {
        $.ajax({
            url: '@Url.Action("GetAvailableTimeSlots")',
            type: 'GET',
            success: function(response) {
                if (response.success) {
                    var selector = $('#time-slot-selector');
                    selector.empty();
                    selector.append('<option value="">Select a time slot...</option>');

                    response.timeSlots.forEach(function(slot) {
                        selector.append('<option value="' + slot.startTime + '|' + slot.endTime + '">' +
                                       slot.timeSlot + '</option>');
                    });
                } else {
                    alert('Error loading time slots: ' + response.message);
                }
            },
            error: function() {
                alert('Error loading time slots. Please try again.');
            }
        });
    }

    // Handle time slot selection
    $('#time-slot-selector').change(function() {
        var selectedValue = $(this).val();
        if (selectedValue) {
            var parts = selectedValue.split('|');
            $('#hidden-start-time').val(parts[0]);
            $('#hidden-end-time').val(parts[1]);
        } else {
            $('#hidden-start-time').val('');
            $('#hidden-end-time').val('');
        }
    });
});
</script>